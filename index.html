<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Click Abyss</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  transition: background 0.2s;
  overflow: hidden;
}
#game { text-align: center; z-index: 1; }
button {
  font-size: 26px;
  padding: 20px 50px;
  cursor: pointer;
}
#count {
  font-size: 36px;
  margin: 20px 0;
}
#msg { min-height: 30px; margin-top: 10px; }
input { padding: 6px; margin-top: 8px; }

#badge {
  margin-top: 10px;
  font-size: 20px;
  color: gold;
}

#matrix {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 0;
}
</style>
</head>
<body>

<canvas id="matrix"></canvas>

<div id="game">
  <h1>üñ±Ô∏è CLICK ABYSS</h1>

  <input id="pseudo" placeholder="Ton pseudo">
  <div id="badge"></div>

  <div id="count">0</div>
  <button id="clickBtn">CLIQUER</button>
  <div id="msg"></div>

  <div>
    <input id="code" placeholder="Code secret">
    <button onclick="useCode()">OK</button>
  </div>

  <div style="margin-top:15px">
    <button onclick="startBlitz()">‚ö° Blitz (1 min)</button>
  </div>
</div>

<audio id="music" loop>
  <source src="https://cdn.pixabay.com/audio/2022/10/25/audio_946b0bfa63.mp3">
</audio>

<script>
// ===================== SAUVEGARDE =====================
let clicks = Number(localStorage.getItem("clicks"));
if (isNaN(clicks)) clicks = 0;

let pseudo = localStorage.getItem("pseudo") || "";
let badge = localStorage.getItem("badge") || "";
let usedCodes = JSON.parse(localStorage.getItem("usedCodes") || "[]");

document.getElementById("pseudo").value = pseudo;
document.getElementById("badge").innerText = badge;

// ===================== ELEMENTS =====================
const countEl = document.getElementById("count");
const msg = document.getElementById("msg");
const btn = document.getElementById("clickBtn");
const music = document.getElementById("music");

// ===================== STATES =====================
let started = false;
let lastThousand = Math.floor(clicks / 1000);
let trollNegative = false;
let trollReset = false;

// ===================== UPDATE =====================
function update() {
  countEl.innerText = clicks.toLocaleString("fr") + " clics";
  localStorage.setItem("clicks", clicks);

  if (clicks >= 1_000_000) matrixActive = true;

  if (clicks >= 10_000_000 && badge !== "üèÜ PRO CLICKER") {
    badge = "üèÜ PRO CLICKER";
    localStorage.setItem("badge", badge);
    document.getElementById("badge").innerText = badge;
    msg.innerText = "üèÜ F√©licitations. Tu es PRO CLICKER.";
  }
}
update();

// ===================== PSEUDO =====================
document.getElementById("pseudo").addEventListener("input", e => {
  pseudo = e.target.value;
  localStorage.setItem("pseudo", pseudo);
});

// ===================== CLIC =====================
btn.onclick = () => {
  if (!started) {
    music.volume = 0.4;
    music.play();
    started = true;
  }

  if (trollReset) {
    clicks = 0;
    update();
    return;
  }

  clicks += trollNegative ? -30 : 1;
  if (clicks < 0) clicks = 0;
  if (clicks > 10_000_000) clicks = 10_000_000;

  document.body.style.background =
    `hsl(${Math.random()*360},70%,15%)`;

  checkThousand();
  update();
};

// ===================== CODES =====================
const codes = {};

function randomCode() {
  return Math.random().toString(36).substring(2, 8).toUpperCase();
}

function checkThousand() {
  const current = Math.floor(clicks / 1000);
  if (current > lastThousand) {
    lastThousand = current;

    const code = randomCode();
    codes[code] = 100 + Math.floor(Math.random() * 900);
    msg.innerText = `üîê Nouveau code : ${code}`;

    if (Math.random() < 0.00000001) {
      codes["PROGODHACKER020304"] = 1_000_000;
      msg.innerText = "‚ö†Ô∏è Un code √©trange a √©t√© g√©n√©r√©...";
    }
  }
}

function useCode() {
  const c = document.getElementById("code").value;
  if (codes[c] && !usedCodes.includes(c)) {
    clicks += codes[c];
    usedCodes.push(c);
    localStorage.setItem("usedCodes", JSON.stringify(usedCodes));
    msg.innerText = `üéâ Code valide (+${codes[c].toLocaleString()})`;
    update();
  } else {
    msg.innerText = "‚ùå Code invalide ou d√©j√† utilis√©";
  }
}

// ===================== BLITZ =====================
function startBlitz() {
  let start = clicks;
  let time = 60;
  msg.innerText = "‚ö° BLITZ !";

  const interval = setInterval(() => {
    time--;
    if (time <= 0) {
      clearInterval(interval);
      msg.innerText = `‚ö° Blitz termin√© : ${clicks - start} clics`;
    }
  }, 1000);
}

// ===================== TROLL INVISIBLE =====================
setInterval(() => {
  if (Math.random() < 0.2) {
    trollNegative = true;
    setTimeout(() => trollNegative = false, 60000);
  }

  if (Math.random() < 0.000005) {
    trollReset = true;
    btn.innerText = "RESET";
    setTimeout(() => {
      trollReset = false;
      btn.innerText = "CLIQUER";
    }, 60000);
  }
}, 600000);

// ===================== MATRIX EFFECT =====================
const matrixCanvas = document.getElementById("matrix");
const mtx = matrixCanvas.getContext("2d");

matrixCanvas.width = innerWidth;
matrixCanvas.height = innerHeight;

const letters = "01ABCDEFGHIJKLMNOPQRSTUVWXYZ#$%&@";
const fontSize = 16;
const columns = matrixCanvas.width / fontSize;
const drops = Array(Math.floor(columns)).fill(1);

let matrixActive = false;

function drawMatrix() {
  if (!matrixActive) return;

  mtx.fillStyle = "rgba(0, 0, 0, 0.05)";
  mtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);

  mtx.fillStyle = "#00ff00";
  mtx.font = fontSize + "px monospace";

  for (let i = 0; i < drops.length; i++) {
    const text = letters[Math.floor(Math.random() * letters.length)];
    mtx.fillText(text, i * fontSize, drops[i] * fontSize);

    if (drops[i] * fontSize > matrixCanvas.height && Math.random() > 0.975) {
      drops[i] = 0;
    }
    drops[i]++;
  }
}

setInterval(drawMatrix, 33);
</script>

</body>
</html>
